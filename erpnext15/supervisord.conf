; Minimal top-level Supervisor config for ERPNext container
; 作用：
; 1) 作为 /etc/supervisor/supervisord.conf 主配置文件
; 2) 统一日志/套接字路径
; 3) include /etc/supervisor/conf.d/*.conf —— 让 bench 生成和（可选的）mariadb/nginx 配置生效
; 注意：
; - 具体的程序项（program:bench-web / bench-workers / bench-schedule / nginx / mariadb）
;   由 bench setup production 生成的 /etc/supervisor/conf.d/<installDir>.conf 提供。
; - 我们的 entrypoint.sh 会按 EXTERNAL_DB=1 时跳过创建 mariadb.conf，从而不启动内置数据库。

[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor
; 说明：nodaemon=true 让它以前台方式运行，便于容器主进程托管。

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory=supervisor.rpcinterface:make_main_rpcinterface

; 关键：引入 bench/entrypoint 生成的 conf
[include]
files = /etc/supervisor/conf.d/*.conf
